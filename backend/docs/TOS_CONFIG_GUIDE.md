# TOS 对象存储配置指南

## 问题说明

如果你遇到以下错误：
```
HTTP 422 (Unprocessable Entity)
TOS Bucket 未配置
```

这说明你需要先配置 TOS 对象存储才能使用本地文件上传功能。

## 🚀 快速配置（3 步完成）

### 第 1 步：登录火山引擎控制台

1. 访问 [火山引擎控制台](https://console.volcengine.com/)
2. 登录你的账号

### 第 2 步：创建 TOS 存储桶（如果还没有）

1. 进入 [TOS 对象存储](https://console.volcengine.com/tos/bucket)
2. 点击 **"创建存储桶"**
3. 填写配置：
   - **桶名称**: 自定义（如：`my-ai-bucket`）
   - **地域**: 选择离你最近的地区（如：华北2-北京）
   - **权限**: 私有读写（推荐）
4. 点击 **"确定"** 创建

### 第 3 步：在应用中配置 TOS

1. 打开浏览器访问 `http://localhost:3000`
2. 点击左侧菜单的 **"⚙️ Settings"**
3. 找到 **"TOS 对象存储配置"** 部分
4. 填写以下信息：

   ```
   Bucket: my-ai-bucket         (你刚创建的桶名称)
   Region: cn-beijing           (对应的地域代码)
   Endpoint: (可选，通常自动生成)
   ```

5. 点击 **"保存 TOS 配置"**

6. 如果还没配置 API 凭证，在 **"API 凭证配置"** 部分填写：
   ```
   AccessKeyId: AKLT***********     (你的访问密钥ID)
   SecretAccessKey: **************** (你的访问密钥密钥)
   ```

7. 点击 **"保存 API 凭证"**

### ✅ 验证配置

1. 进入 **"动作模仿"** 页面
2. 选择 **"本地文件"** 输入方式
3. 上传一张测试图片
4. 如果看到 **"正在上传图片到对象存储..."**，说明配置成功！

## 📋 地域代码对照表

| 地域名称 | Region 代码 |
|---------|------------|
| 华北2-北京 | cn-beijing |
| 华东2-上海 | cn-shanghai |
| 华南1-广州 | cn-guangzhou |
| 华中1-武汉 | cn-wuhan |

完整列表见：[火山引擎 TOS 地域列表](https://www.volcengine.com/docs/6349/107356)

## ❓ 常见问题

### Q1: 我没有 TOS 存储桶怎么办？

**A**: 可以使用 **URL 方式** 而不是本地文件上传：
1. 先将图片和视频上传到任何支持外链的对象存储（TOS、OSS、COS等）
2. 获取文件的公网 URL
3. 在动作模仿页面选择 **"URL地址"** 输入方式
4. 直接粘贴 URL 即可

### Q2: 不想创建 TOS 存储桶，有其他方式吗？

**A**: 可以使用其他对象存储服务：
- 阿里云 OSS
- 腾讯云 COS
- AWS S3
- 七牛云
- 又拍云

只要能获取文件的公网 URL，就可以使用 URL 方式。

### Q3: 上传后提示 "NoSuchBucket" 错误

**A**: 原因和解决：
1. **Bucket 名称错误**: 检查是否输入正确
2. **Region 不匹配**: 确保 Region 代码与 Bucket 所在地域一致
3. **Bucket 不存在**: 登录控制台确认 Bucket 已创建

### Q4: 上传后提示 "403 Forbidden" 错误

**A**: 原因和解决：
1. **AccessKey 权限不足**: 确保 AccessKey 有 TOS 上传权限
2. **Bucket 权限设置**: 检查 Bucket 是否允许上传
3. **签名错误**: 检查 SecretAccessKey 是否正确

### Q5: 文件大小限制是多少？

**A**: 
- **图片**: ≤ 10MB（前端验证）
- **视频**: ≤ 100MB（后端限制）

如果需要上传更大的文件：
- 压缩文件
- 或者使用 URL 方式（无大小限制）

## 🔒 安全建议

1. **不要分享 AccessKey**: 这相当于你的账号密码
2. **定期轮换密钥**: 建议每 3-6 个月更换一次
3. **使用子账号**: 创建专用子账号，只授予必要权限
4. **限制 Bucket 权限**: 
   - 不要设置为公共读写
   - 只允许上传，不允许列举
   - 设置合理的生命周期规则

## 📸 配置截图示例

### Settings 页面 - TOS 配置部分

```
┌─────────────────────────────────────────┐
│  TOS 对象存储配置                        │
├─────────────────────────────────────────┤
│  Bucket Name:  [my-ai-bucket         ]  │
│  Region:       [cn-beijing           ]  │
│  Endpoint:     [(可选)                ]  │
│                                          │
│  [保存 TOS 配置]                         │
└─────────────────────────────────────────┘
```

### Settings 页面 - API 凭证配置部分

```
┌─────────────────────────────────────────┐
│  API 凭证配置                            │
├─────────────────────────────────────────┤
│  AccessKeyId:     [AKLT***********   ]  │
│  SecretAccessKey: [****************  ]  │
│                                          │
│  [保存 API 凭证]                         │
└─────────────────────────────────────────┘
```

## 💡 推荐工作流程

### 方式 1: 使用本地文件上传（需要配置 TOS）

```
配置 TOS → 上传文件 → 自动获取 URL → 提交任务
```

**优点**:
- 方便快捷
- 无需手动上传到对象存储
- 一键完成

**缺点**:
- 需要配置 TOS
- 有文件大小限制

### 方式 2: 使用 URL 方式（无需配置 TOS）

```
手动上传到对象存储 → 获取 URL → 粘贴 URL → 提交任务
```

**优点**:
- 无需配置 TOS
- 无文件大小限制
- 可以使用任何对象存储服务

**缺点**:
- 需要手动上传文件
- 多一个步骤

## 📞 获取帮助

如果配置后仍然有问题，请检查：

1. **浏览器控制台**: 按 F12 查看详细错误信息
2. **后端日志**: 查看 `backend/backend.log`
3. **网络面板**: 查看请求和响应内容

---

**更新时间**: 2025-10-20  
**文档版本**: 1.0



