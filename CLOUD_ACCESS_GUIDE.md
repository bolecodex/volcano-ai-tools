# 云服务器访问配置指南

## 问题分析

您的云服务器无法通过公有IP访问，可能的原因：
1. **防火墙未开放端口** - 系统防火墙阻止了外部访问
2. **安全组未配置** - 云服务商的安全组规则未开放端口
3. **服务绑定地址** - 服务可能只绑定了localhost

## 解决方案

### 方案1：配置系统防火墙（推荐）

```bash
# 在云服务器上执行
./configure-firewall.sh
```

### 方案2：使用Nginx反向代理

```bash
# 1. 配置防火墙
./configure-firewall.sh

# 2. 安装和配置Nginx
./setup-nginx.sh

# 3. 重启服务
./start-cloud-simple.sh
```

### 方案3：直接端口访问

```bash
# 配置防火墙后，直接访问
http://115.190.184.251:3000  # 前端
http://115.190.184.251:8000  # 后端API
```

## 云服务商安全组配置

### 阿里云ECS
1. 登录阿里云控制台
2. 进入ECS实例管理
3. 点击"安全组" → "配置规则"
4. 添加入方向规则：
   - 端口范围：22/22，协议：TCP，授权对象：0.0.0.0/0
   - 端口范围：80/80，协议：TCP，授权对象：0.0.0.0/0
   - 端口范围：443/443，协议：TCP，授权对象：0.0.0.0/0
   - 端口范围：3000/3000，协议：TCP，授权对象：0.0.0.0/0
   - 端口范围：8000/8000，协议：TCP，授权对象：0.0.0.0/0

### 腾讯云CVM
1. 登录腾讯云控制台
2. 进入CVM实例管理
3. 点击"安全组" → "修改规则"
4. 添加入站规则：
   - 类型：自定义，端口：22，协议：TCP，来源：0.0.0.0/0
   - 类型：自定义，端口：80，协议：TCP，来源：0.0.0.0/0
   - 类型：自定义，端口：443，协议：TCP，来源：0.0.0.0/0
   - 类型：自定义，端口：3000，协议：TCP，来源：0.0.0.0/0
   - 类型：自定义，端口：8000，协议：TCP，来源：0.0.0.0/0

### 华为云ECS
1. 登录华为云控制台
2. 进入ECS实例管理
3. 点击"安全组" → "入方向规则"
4. 添加规则：
   - 协议端口：TCP(22)，源地址：0.0.0.0/0
   - 协议端口：TCP(80)，源地址：0.0.0.0/0
   - 协议端口：TCP(443)，源地址：0.0.0.0/0
   - 协议端口：TCP(3000)，源地址：0.0.0.0/0
   - 协议端口：TCP(8000)，源地址：0.0.0.0/0

## 验证访问

### 1. 检查端口监听
```bash
# 在云服务器上执行
netstat -tlnp | grep -E ":(80|443|3000|8000|22) "
```

### 2. 测试本地访问
```bash
# 在云服务器上执行
curl http://localhost:3000
curl http://localhost:8000/health
```

### 3. 测试外网访问
```bash
# 在本地执行
curl http://115.190.184.251:3000
curl http://115.190.184.251:8000/health
```

## 推荐配置

### 生产环境配置
1. **使用Nginx反向代理** - 通过80端口访问
2. **配置SSL证书** - 启用HTTPS
3. **配置域名** - 使用域名而非IP访问
4. **限制访问IP** - 根据需要限制访问来源

### 开发环境配置
1. **直接端口访问** - 使用3000和8000端口
2. **配置防火墙** - 开放必要端口
3. **使用安全组** - 在云服务商控制台配置

## 故障排除

### 1. 端口无法访问
```bash
# 检查服务是否运行
ps aux | grep -E "(python|node|nginx)"

# 检查端口监听
netstat -tlnp | grep -E ":(80|443|3000|8000) "

# 检查防火墙状态
ufw status  # Ubuntu/Debian
firewall-cmd --list-all  # CentOS/RHEL
```

### 2. 服务无法启动
```bash
# 检查日志
journalctl -u nginx -f
tail -f backend/logs/backend.log
```

### 3. 权限问题
```bash
# 检查文件权限
ls -la /etc/nginx/nginx.conf
ls -la nginx/nginx-production.conf

# 修复权限
chmod 644 /etc/nginx/nginx.conf
chown root:root /etc/nginx/nginx.conf
```

## 快速启动命令

```bash
# 一键配置访问
./configure-firewall.sh && ./setup-nginx.sh && ./start-cloud-simple.sh
```

配置完成后，您就可以通过以下地址访问应用：
- **应用首页**: http://115.190.184.251
- **API接口**: http://115.190.184.251/api/
- **健康检查**: http://115.190.184.251/health
