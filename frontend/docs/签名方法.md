# 火山引擎API签名方法

## 概述

火山引擎API使用签名机制来验证请求者身份并防止请求被篡改。本文介绍了火山引擎API的签名过程。

## 签名算法

火山引擎使用 **HMAC-SHA256** 签名算法，与AWS4签名格式类似但有一些关键差异。

## 签名步骤

### 步骤一：获取访问密钥

获取火山引擎账号的访问密钥（Access Key ID 和 Secret Access Key）。

### 步骤二：创建规范请求

```
CanonicalRequest = 
        HTTPRequestMethod + '\n' + 
        CanonicalURI + '\n' + 
        CanonicalQueryString + '\n' + 
        CanonicalHeaders + '\n' + 
        SignedHeaders + '\n' + 
        HexEncode(Hash(RequestPayload))
```

### 步骤三：创建待签名字符串

```
StringToSign =
        Algorithm + '\n' +
        RequestDate + '\n' +
        CredentialScope + '\n' +
        HexEncode(Hash(CanonicalRequest))
```

### 步骤四：派生签名密钥

```
kSecret = Your Secret Access Key
kDate = HMAC(kSecret, Date)
kRegion = HMAC(kDate, Region)
kService = HMAC(kRegion, Service)
kSigning = HMAC(kService, "request")
```

### 步骤五：计算签名

```
Signature = HexEncode(HMAC(kSigning, StringToSign))
```

### 步骤六：构建Authorization头

```
Authorization: HMAC-SHA256 Credential={AccessKeyId}/{CredentialScope}, SignedHeaders={SignedHeaders}, Signature={Signature}
```

## 关键参数

- **Algorithm**: `HMAC-SHA256`
- **时间戳头**: `X-Date` (不是X-Amz-Date)
- **凭证范围**: `{YYYYMMDD}/{region}/{service}/request`
- **签名头**: `host;x-date`

## 示例

### GET请求示例

```
GET
/
Action=QueryBalanceAcct&Version=2022-01-01
host:billing.volcengineapi.com
x-date:20250329T180937Z

host;x-date
e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
```

### POST请求示例

```
POST
/
Action=ListBill&Version=2022-01-01
host:billing.volcengineapi.com
x-date:20250329T180937Z

host;x-date
e8cc56e129d9759d56c936e679a345d001a4235b58bee8e935ccad97f23ed663
```

## 注意事项

1. 使用HMAC-SHA256算法，不是AWS4-HMAC-SHA256
2. 时间戳头使用X-Date，不是X-Amz-Date
3. 凭证范围格式为 `{date}/{region}/{service}/request`
4. 签名头格式为 `host;x-date`
5. 所有字符串都使用UTF-8编码
6. 查询参数需要按ASCII升序排序

## 参考文档

- [火山引擎API签名调用指南](https://www.volcengine.com/docs/6348/69824)
- [火山引擎视觉服务API文档](https://www.volcengine.com/docs/6348/69824)