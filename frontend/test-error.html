<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频编辑错误测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .error { color: red; background: #ffe6e6; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { color: green; background: #e6ffe6; padding: 10px; border-radius: 5px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>视频编辑错误测试</h1>
    
    <div>
        <button onclick="testQuery()">测试查询任务</button>
        <button onclick="testErrorHandling()">测试错误处理</button>
    </div>
    
    <div id="result"></div>

    <script>
        async function testQuery() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>正在测试查询...</p>';
            
            try {
                const response = await fetch('http://localhost:8000/api/volcano/visual/CVSync2AsyncGetResult/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Access-Key-Id': 'YOUR_ACCESS_KEY_ID',
                        'X-Secret-Access-Key': 'YOUR_SECRET_ACCESS_KEY'
                    },
                    body: JSON.stringify({
                        req_key: 'dm_seedance_videoedit_tob',
                        task_id: '16736531953053807917'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    if (data.detail && data.detail.message) {
                        resultDiv.innerHTML = `
                            <div class="error">
                                <h3>❌ 火山引擎API错误</h3>
                                <p><strong>错误信息:</strong> ${data.detail.message}</p>
                                <p><strong>错误码:</strong> ${data.detail.code}</p>
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `
                            <div class="success">
                                <h3>✅ 查询成功</h3>
                                <pre>${JSON.stringify(data, null, 2)}</pre>
                            </div>
                        `;
                    }
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h3>❌ HTTP错误</h3>
                            <p><strong>状态码:</strong> ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>❌ 请求异常</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function testErrorHandling() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div class="error">
                    <h3>🔍 错误分析</h3>
                    <p><strong>问题:</strong> 视频文件无法被火山引擎的ComfyUI管道加载</p>
                    <p><strong>可能原因:</strong></p>
                    <ul>
                        <li>视频格式不支持（建议使用标准MP4格式）</li>
                        <li>视频文件损坏</li>
                        <li>视频文件无法访问（请检查TOS权限设置）</li>
                        <li>视频文件过大或时长过长</li>
                    </ul>
                    <p><strong>解决方案:</strong></p>
                    <ul>
                        <li>重新上传一个标准的MP4格式视频文件</li>
                        <li>确保文件≤15MB，时长≤10秒，分辨率≤1080P</li>
                        <li>检查TOS Bucket的公共读权限设置</li>
                        <li>或使用其他公网可访问的视频URL</li>
                    </ul>
                </div>
            `;
        }
    </script>
</body>
</html>
